<!DOCTYPE html>
<html lang="ru">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MJSGV90123"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-MJSGV90123');
</script>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>D00M4ACE блог ИИ и геймдев - Заметки</title><meta name="description" content="Заметки по Git, Nginx, PostgreSQL и созданию служб в Windows."/>
<link rel="stylesheet" type="text/css" href="/css/mystyles.css"/>
<link rel="stylesheet" type="text/css" href="/css/codehilite.css"/>
<link rel="stylesheet" type="text/css" href="/css/modding.css"/>
<script async defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
<script defer language="javascript" type="text/javascript" src="/js/main.js"></script>
<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(96437642, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/96437642" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
</head>
<body>

<nav id="navbar" class="bd-navbar navbar">
  <div class="navbar-brand">
    <a class="navbar-item" href="https://d00m4ace.com">
      <img src="/imgs/d00m4ace-c-box.png" alt="D00M4ACE блог ИИ и геймдев">
    </a>

    <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample">
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
    </a>
  </div>
  <div id="navbarBasicExample" class="navbar-menu">
    <div class="navbar-start">
	
      <a class="navbar-item  is-info" href="/posts/">
        <strong>Блог</strong>
      </a> &nbsp;	 

      <a class="navbar-item  is-info" href="/projects/">
        <strong>Проекты</strong>
      </a> &nbsp;	 
	
	  <a class="navbar-item  is-info" href="/posts/tags/">
        <strong>Тэги</strong>
      </a> &nbsp;
	  
	   <a class="navbar-item  is-info" href="/shortcuts/">
        <strong>Заметки</strong>
      </a> &nbsp;
	  
    </div>
	
	
	<div class="navbar-end">
      <div class="navbar-item">
	  
	<a class="navbar-item" href="https://github.com/d00m4ace" target="_blank">
      <img src="/imgs/github-mark.png" alt="D00M4ACE GitHub">
    </a>

	<a class="navbar-item" href="https://t.me/d00m4ace_blog" target="_blank">
      <img src="/imgs/telega-mark.png" alt="D00M4ACE Telegram">
    </a>
	
	<a class="navbar-item" href="https://www.youtube.com/@d00m4ace" target="_blank">
      <img src="/imgs/youtube-mark.png" alt="D00M4ACE YouTube">
    </a>
	&nbsp;	
	 
	<button id="color-switcher" class="button">
    <i id="theme-icon" class="fas fa-moon"></i>
  </button>
  &nbsp;
	 
	<input type="text" class="input" id="searchBox" placeholder="Enter your search terms here">&nbsp;
    <button id="searchButton" class="button">Search</button>

      </div>
    </div>
	
  </div>
</nav>

<section class="section" style="padding-top: 10px; padding-bottom: 10px;">
<main class="container mb-6">

<div id="searchResults"></div>


<article class="content">
<h1>Заметки</h1>
<h2>Git</h2>
<p>Для начала определим пользователья глобально и перенос новых строк отключим авто замену CRLF обратно на LF.
И также <strong>core.symlinks true</strong> позволяет Git создавать и обрабатывать символические ссылки. Для работы с символическими ссылками необходимо запускать Git из командной строки Windows (CMD) с правами администратора.</p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code><span class="n">git</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">--</span><span class="k">global</span><span class="w"> </span><span class="n">core</span><span class="p">.</span><span class="n">autocrlf</span><span class="w"> </span><span class="k">false</span>
<span class="n">git</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">--</span><span class="k">global</span><span class="w"> </span><span class="n">core</span><span class="p">.</span><span class="n">symlinks</span><span class="w"> </span><span class="k">true</span>
<span class="n">git</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">--</span><span class="k">global</span><span class="w"> </span><span class="k">user</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="ss">"username"</span>
<span class="n">git</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="c1">--global user.email "username@mail.com"</span>
</code></pre></div></div>
<p>Для создания нового репозитория и отправки всего его содержимого в новый уже созданый репозиторий на github:</p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code>git init
git config --local core.symlinks true
git add .
git status

git commit -m "first commit"
git branch -M main
git remote add origin https://github.com/d00m4ace/hex.play.git
git push -u origin main
</code></pre></div></div>
<p>Если вы хотите скопировать существующий репозиторий, используйте команду <strong>git clone</strong>:</p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code>git clone --config core.symlinks=true https://github.com/d00m4ace/HEXPLAY.git
</code></pre></div></div>
<p>Проверьте обновления с сервера</p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code>git pull
git status
git merge
</code></pre></div></div>
<p>Добавьте свои изменения</p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code>git add .
git commit -m "Your descriptive commit message here"
git push
</code></pre></div></div>
<p>Чтобы отменить последний <strong>git add</strong>, вы можете использовать команду <strong>git reset</strong> 
Эта команда снимет индексацию с изменений, но сохранит сами изменения в файлах. </p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code>git reset
</code></pre></div></div>
<p>Чтобы отменить изменения в рабочей копии, которые не добавлены в индекс (не подготовлены к коммиту), вы можете использовать команду git checkout или git restore, в зависимости от версии Git, которую вы используете. Для Git версии 2.23 и новее рекомендуется использовать git restore.</p>
<p>Чтобы отменить изменения в конкретном файле</p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code>git restore path/to/file/to/revert
</code></pre></div></div>
<p>Чтобы отменить изменения во всей рабочей директории</p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code>git restore .
</code></pre></div></div>
<h1>Nginx</h1>
<p>Запуск Nginx</p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code>start nginx
</code></pre></div></div>
<p>Остановка Nginx</p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code>nginx -s stop
</code></pre></div></div>
<p><strong>Эта команда останавливает Nginx немедленно. Это может привести к потере данных, которые еще не были записаны на диск.</strong></p>
<p>Безопасная остановка Nginx</p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code>nginx -s quit
</code></pre></div></div>
<p>Перезапуск Nginx</p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code><span class="n">nginx</span><span class="w"> </span><span class="o">-</span><span class="n">s</span><span class="w"> </span><span class="n">reload</span>
</code></pre></div></div>
<p><em>Эта команда перезапускает Nginx, что полезно при изменении конфигурационных файлов.</em></p>
<p>Проверка конфигурации Nginx</p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code>nginx -t
</code></pre></div></div>
<h2>Создать новую службу в Windows</h2>
<p><a href="/posts/komanda-sc-create-dlja-sozdanija-novyh-sluzhb-v-windows/">Команда sc create для создания новых служб в Windows</a>:</p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code><span class="n">sc</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="p">[</span><span class="n">service</span><span class="w"> </span><span class="n">name</span><span class="p">]</span><span class="w"> </span><span class="n">binPath</span><span class="o">=</span><span class="w"> </span><span class="s">"[path to the .exe]"</span>

<span class="n">sc</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">nginx</span><span class="w"> </span><span class="n">binPath</span><span class="o">=</span><span class="w"> </span><span class="s">"C:</span><span class="se">\n</span><span class="s">ginx</span><span class="se">\n</span><span class="s">ginx.exe"</span>
</code></pre></div></div>
<p>Следует также отметить, что команда <strong>sc create</strong> создает службу с настройками по умолчанию. В частности, служба будет работать под учетной записью <strong>LocalSystem</strong> и не будет автоматически запускаться при старте системы. Вы можете изменить эти и другие настройки с помощью дополнительных опций команды <strong>sc create</strong> или через Менеджер служб Windows.</p>
<p>После того как служба создана, вы можете запустить ее с помощью команды <strong>sc start [service name]</strong>, а остановить - с помощью команды <strong>sc stop [service name]</strong>.</p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code>sc start nginx
sc stop nginx
</code></pre></div></div>
<p>Так же команды <strong>net start</strong> и <strong>net stop</strong> используются в командной строке Windows для управления службами Windows.</p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code>net start nginx
net stop nginx
</code></pre></div></div>
<p>Если вы часто перезапускаете службу, может быть удобно создать скрипт для этого. Например, вы можете создать файл <strong>!.bat</strong> со следующим содержимым:</p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code><span class="nv">@echo</span><span class="w"> </span><span class="k">off</span>
<span class="n">net</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">nginx</span>
<span class="n">net</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="n">nginx</span>
</code></pre></div></div>
<h2>Curl</h2>
<p>Отправляет POST-запрос с JSON-телом. Здесь -H "Content-Type: application/json" указывает, что тело запроса будет в формате JSON. -d "{\"name\":\"John\", \"age\":30}" это данные, которые вы отправляете в теле запроса.</p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code>C:\curl\curl -X POST -H "Content-Type: application/json" -d "{\"name\":\"John\", \"age\":30}" https://test.hexplay.com/post
</code></pre></div></div>
<p>Отправляет POST-запрос с данными в формате x-www-form-urlencoded. Здесь -H "Content-Type: application/x-www-form-urlencoded" указывает, что тело запроса будет в формате x-www-form-urlencoded, а -d "name=John&amp;age=30" это данные, которые вы отправляете.</p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code>C:\curl\curl -X POST -H "Content-Type: application/x-www-form-urlencoded" -d "name=John&amp;age=30" https://test.hexplay.com/post
</code></pre></div></div>
<p>Отправляет POST-запрос с текстовыми данными. Здесь -H "Content-Type: text/plain" указывает, что тело запроса будет текстовым, а -d "Hello, World!" это данные, которые вы отправляете.</p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code>C:\curl\curl -X POST -H "Content-Type: text/plain" -d "Hello, World!" https://test.hexplay.com/post
</code></pre></div></div>
<p>Отправит GET-запрос на указанный URL с параметрами name=John и age=30, и вы увидите ответ в командной строке.</p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code>C:\curl\curl "https://test.hexplay.com/get?name=John&amp;age=30"
</code></pre></div></div>
<p><strong>-O</strong> (заглавная "O", а не ноль) говорит curl сохранить файл с оригинальным именем файла из URL.</p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code>curl -O https://example.com/path/to/file
</code></pre></div></div>
<p>Эта команда загрузит файл, как и прежде, но сохранит его под именем newfile.</p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code>curl -o newfile https://example.com/path/to/file
</code></pre></div></div>
<p>Опция -z позволяет указать время и дату файла. Если файл на сервере новее указанного времени, curl загрузит его.</p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code>curl -z localfile -O https://example.com/path/to/file
</code></pre></div></div>
<p>В этом случае curl сначала проверяет время последнего изменения локального файла (localfile). Если файл на сервере новее, curl загрузит его и перезапишет локальный файл.</p>
<h2>mklink</h2>
<p>Помните, что для выполнения команды <strong>mklink</strong> вам нужны административные права в Windows. </p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code>mklink /d code ..\..\code
</code></pre></div></div>
<p>Создает символическую ссылку с именем "<strong>code</strong>" на каталог "<strong>..\..\code</strong>" относительно текущего местоположения в файловой системе.
Используется флаг <strong>/d</strong>, который указывает, что вы создаете символическую ссылку на каталог, а не на файл.</p>
<h2>7z</h2>
<p>Скрипт Windows Batch создает архив <strong>7z</strong> директории <strong>HEXPLAY</strong>\ с помощью 7-Zip и именуют его в зависимости от текущей даты и времени, исключая директории <strong>.vs, x64, Debug, Release, output,</strong> и <strong>.git</strong>.
<strong>!BACKUP.bat</strong></p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code>set target="%DATE:~-4%.%DATE:~4,2%.%DATE:~7,2%-%TIME:~0,2%.%TIME:~3,2%.%TIME:~-5%-HEXPLAY-BACKUP-mx5".7z
"C:\Program Files\7-Zip\7z.exe" a -t7z %target% HEXPLAY\ -mx5 -xr!.vs -xr!x64 -xr!Debug -xr!Release -xr!output -xr!.git
copy %target% "G:\My Drive\BACKUP"
copy %target% "E:\BACKUP\"
</code></pre></div></div>
<ul>
<li>Первая команда: устанавливает переменную target с именем файла, включающим текущую дату и время, а также суффикс <strong>-HEXPLAY-BACKUP-mx5</strong> и расширением <strong>.7z</strong>. Использование <strong>%DATE%</strong> и <strong>%TIME%</strong> с подстроками создает дату и время в нужном формате.</li>
<li>Вторая команда: использует 7-Zip для создания архива <strong>7z</strong>. Опция a добавляет файлы в архив, <strong>-t7z</strong> указывает тип архива (7z), <strong>%target%</strong> является именем создаваемого архива, <strong>HEXPLAY</strong>\ это директория, которую нужно архивировать, <strong>-mx5</strong> задает уровень сжатия, а <strong>-xr!</strong> используется для исключения определенных директорий или файлов из процесса архивации.</li>
<li>Третья и четвертая команды: копирует файл в директорию <strong>BACKUP</strong> на диске G, и копирует файл в директорию <strong>BACKUP</strong> на диске E.</li>
</ul>
<p>Убедитесь, что путь к 7z.exe верный и что директория <strong>HEXPLAY</strong>\ существует. Если они не существуют или неправильно указаны, вы получите ошибку.</p>
<h2>PostgreSQL</h2>
<p>pg_env.bat скрипт настраивает среду для PostgreSQL. </p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code>C:\PostgreSQL\16\pg_env.bat
</code></pre></div></div>
<p>Cоздаем резервную копию базы данных PostgreSQL с именем "mydb". </p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code>C:\PostgreSQL\16\bin\pg_dump -U postgres -W -F t -b -v mydb &gt; dbbackup.tar
</code></pre></div></div>
<ul>
<li>"pg_dump": утилита, предоставляемая PostgreSQL для создания резервных копий баз данных.</li>
<li>"-U postgres": указывает, что вы хотите использовать пользователя PostgreSQL с именем "postgres" для создания резервной копии.</li>
<li>"-W": заставит команду запросить пароль для пользователя.</li>
<li>"-F t": указывает, что резервная копия должна быть создана в формате tar.</li>
<li>"-b": включает в дамп большие объекты.</li>
<li>"-v": включает режим verbose для отображения подробной информации в процессе резервного копирования.</li>
<li>"mydb": имя базы данных, которую вы хотите сохранить.</li>
<li>"&gt; dbbackup.tar": перенаправляет вывод команды pg_dump (то есть резервную копию) в файл с именем "dbbackup.tar". Если файл с этим именем уже существует, он будет перезаписан.</li>
</ul>
<p>Команда восстанавливает базу данных PostgreSQL с именем "mydb" из резервной копии, находящейся в файле "dbbackup.tar". </p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code>C:\PostgreSQL\16\bin\pg_restore -U postgres -W -d mydb -1 --clean dbbackup.tar
</code></pre></div></div>
<ul>
<li>"pg_restore": утилита, предоставляемая PostgreSQL для восстановления баз данных из резервных копий.</li>
<li>"-U postgres": указывает, что вы хотите использовать пользователя PostgreSQL с именем "postgres" для восстановления.</li>
<li>"-W": заставит команду запросить пароль для пользователя.</li>
<li>"-d mydb": имя базы данных, которую вы хотите восстановить. Обратите внимание, что эта база данных должна уже существовать перед восстановлением. Если она не существует, вы можете создать ее с помощью утилиты createdb.</li>
<li>"-1": опция указывает, что восстановление должно быть выполнено в одной транзакции. Таким образом, если во время восстановления произойдет какая-либо ошибка, все изменения, сделанные во время восстановления, будут откачены, оставив базу данных в ее исходном состоянии.</li>
<li>"--clean": Это приведет к удалению существующих объектов в целевой базы данных перед их восстановлением из файла резервной копии. </li>
<li>"dbbackup.tar": имя файла резервной копии, которую вы хотите восстановить.</li>
</ul>
<p>Если вы сталкиваетесь с ошибкой, указывающей на отсутствие базы данных mydb, и хотите создать её, команда createdb является правильным способом её создания. </p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code>C:\PostgreSQL\16\bin\createdb -U postgres mydb
</code></pre></div></div>
<p>Файл pgpass.conf используется командной строкой PostgreSQL для хранения паролей для подключений к базам данных. Он обычно находится в папке %APPDATA%\postgresql\pgpass.conf для пользователя, запускающего PostgreSQL.</p>
<p>Формат содержимого файла:</p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code><span class="n">localhost</span><span class="o">:</span><span class="mi">5433</span><span class="o">:</span><span class="n">mydb</span><span class="o">:</span><span class="n">my_user_postgres</span><span class="o">:</span><span class="n">my_user_postgres_password</span>
</code></pre></div></div>
<p>Это означает, что при использовании утилит pg_dump и pg_restore для базы данных mydb подключение будет происходить без запроса пароля для пользователя my_user_postgres, используя пароль my_user_postgres_password для подключения к базе данных на localhost через порт 5433.</p>
<p>Рекомендуется хранить пароль в pgpass.conf с ограниченным доступом и указать его расположение в строке подключения с помощью passfile, чтобы обеспечить успешную аутентификацию.</p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code>set PGPASSFILE=C:\projects\pgpass.conf
C:\PostgreSQL\16\bin\pg_dump -U postgres -F t mydb &gt; dbbackup.tar
</code></pre></div></div>
<p>Эта команда устанавливает переменную окружения PGPASSFILE путь к файлу pgpass.conf, а затем запускает команду pg_dump для создания резервной копии базы данных mydb в формате tar, сохраняя ее в файле dbbackup.tar.</p>
<p>Вы можете временно установить переменную среды PGPASSWORD перед выполнением команды для избежания запроса пароля:</p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code>set PGPASSWORD=yourpassword
C:\PostgreSQL\16\bin\createdb -U postgres mydb
</code></pre></div></div>
<p>Учтите, что использование PGPASSWORD может представлять риски безопасности, особенно на машинах с несколькими пользователями или в скриптах.</p>
<p>Проверка существующих баз данных: Чтобы проверить, какие базы данных уже существуют на вашем сервере PostgreSQL, вы можете использовать команду psql:</p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code>C:\PostgreSQL\16\bin\psql -U postgres -l
</code></pre></div></div>
<h3>Автоматизация процесса резервного копирования базы данных PostgreSQL</h3>
<p>Скрипт <code>all_dump.bat</code> автоматизирует процесс создания резервной копии базы данных PostgreSQL с уникальным именем файла, включающим текущую дату и время:</p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code><span class="n">set</span><span class="w"> </span><span class="n">psql_path</span><span class="o">=</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">PostgreSQL</span><span class="err">\</span><span class="mi">16</span>
<span class="n">set</span><span class="w"> </span><span class="n">PGPASSWORD</span><span class="o">=</span><span class="n">d00m4ace</span>
<span class="n">call</span><span class="w"> </span><span class="nf">%psql_path</span><span class="o">%</span><span class="err">\</span><span class="n">pg_env</span><span class="p">.</span><span class="n">bat</span>

<span class="k">for</span><span class="w"> </span><span class="o">/</span><span class="n">f</span><span class="w"> </span><span class="s">"tokens=2 delims=="</span><span class="w"> </span><span class="o">%%</span><span class="n">I</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="p">(</span><span class="err">'</span><span class="n">wmic</span><span class="w"> </span><span class="n">os</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">localdatetime</span><span class="w"> </span><span class="o">/</span><span class="n">format</span><span class="o">:</span><span class="n">list</span><span class="err">'</span><span class="p">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">datetime</span><span class="o">=%%</span><span class="n">I</span>
<span class="n">set</span><span class="w"> </span><span class="n">date</span><span class="o">=</span><span class="nf">%datetime</span><span class="o">:~</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="o">%</span><span class="p">.</span><span class="nf">%datetime</span><span class="o">:~</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="o">%</span><span class="p">.</span><span class="nf">%datetime</span><span class="o">:~</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="o">%</span>
<span class="n">set</span><span class="w"> </span><span class="n">time</span><span class="o">=</span><span class="nf">%datetime</span><span class="o">:~</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="o">%</span><span class="p">.</span><span class="nf">%datetime</span><span class="o">:~</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="o">%</span><span class="p">.</span><span class="nf">%datetime</span><span class="o">:~</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="o">%</span>
<span class="n">set</span><span class="w"> </span><span class="n">target</span><span class="o">=</span><span class="s">"%date%-%time%-dbbackup.tar"</span>

<span class="nf">%psql_path</span><span class="o">%</span><span class="err">\</span><span class="n">bin</span><span class="err">\</span><span class="n">pg_dump</span><span class="w"> </span><span class="o">-</span><span class="n">U</span><span class="w"> </span><span class="n">postgres</span><span class="w"> </span><span class="o">-</span><span class="n">F</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">-</span><span class="n">b</span><span class="w"> </span><span class="o">-</span><span class="n">v</span><span class="w"> </span><span class="n">d00m4ace</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nf">%target</span><span class="o">%</span>

<span class="n">echo</span><span class="w"> </span><span class="n">Backup</span><span class="w"> </span><span class="n">completed</span><span class="o">:</span><span class="w"> </span><span class="nf">%target</span><span class="o">%</span>
</code></pre></div></div>
<p>Скрипт <code>all_dump.bat</code> выполняет следующие действия:</p>
<ol>
<li>Устанавливает путь к PostgreSQL и пароль.</li>
<li>Загружает переменные окружения PostgreSQL.</li>
<li>Получает текущую дату и время.</li>
<li>Формирует имя файла резервной копии с текущей датой и временем.</li>
<li>Выполняет резервное копирование базы данных "d00m4ace" с помощью pg_dump.</li>
<li>Сохраняет резервную копию в файл формата .tar.</li>
<li>Выводит сообщение о завершении резервного копирования.</li>
</ol>
<p>Скрипт <code>dump.bat</code> автоматизирует процесс создания резервной копии определенных таблиц из базы данных PostgreSQL.</p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code><span class="n">set</span><span class="w"> </span><span class="n">psql_path</span><span class="o">=</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">PostgreSQL</span><span class="err">\</span><span class="mi">16</span>
<span class="n">set</span><span class="w"> </span><span class="n">PGPASSWORD</span><span class="o">=</span><span class="n">d00m4ace</span>
<span class="n">call</span><span class="w"> </span><span class="nf">%psql_path</span><span class="o">%</span><span class="err">\</span><span class="n">pg_env</span><span class="p">.</span><span class="n">bat</span>

<span class="k">for</span><span class="w"> </span><span class="o">/</span><span class="n">f</span><span class="w"> </span><span class="s">"tokens=2 delims=="</span><span class="w"> </span><span class="o">%%</span><span class="n">I</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="p">(</span><span class="err">'</span><span class="n">wmic</span><span class="w"> </span><span class="n">os</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">localdatetime</span><span class="w"> </span><span class="o">/</span><span class="n">format</span><span class="o">:</span><span class="n">list</span><span class="err">'</span><span class="p">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">datetime</span><span class="o">=%%</span><span class="n">I</span>
<span class="n">set</span><span class="w"> </span><span class="n">date</span><span class="o">=</span><span class="nf">%datetime</span><span class="o">:~</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="o">%</span><span class="p">.</span><span class="nf">%datetime</span><span class="o">:~</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="o">%</span><span class="p">.</span><span class="nf">%datetime</span><span class="o">:~</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="o">%</span>
<span class="n">set</span><span class="w"> </span><span class="n">time</span><span class="o">=</span><span class="nf">%datetime</span><span class="o">:~</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="o">%</span><span class="p">.</span><span class="nf">%datetime</span><span class="o">:~</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="o">%</span><span class="p">.</span><span class="nf">%datetime</span><span class="o">:~</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="o">%</span>
<span class="n">set</span><span class="w"> </span><span class="n">target</span><span class="o">=</span><span class="s">"%date%-%time%-dbbackup.sql"</span>

<span class="o">::</span><span class="w"> </span><span class="n">Выберите</span><span class="w"> </span><span class="n">один</span><span class="w"> </span><span class="n">из</span><span class="w"> </span><span class="n">двух</span><span class="w"> </span><span class="n">вариантов</span><span class="w"> </span><span class="n">ниже</span><span class="o">:</span>
<span class="o">::</span><span class="w"> </span><span class="n">Вариант</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="n">Список</span><span class="w"> </span><span class="n">таблиц</span><span class="w"> </span><span class="n">прямо</span><span class="w"> </span><span class="n">в</span><span class="w"> </span><span class="n">скрипте</span>
<span class="n">set</span><span class="w"> </span><span class="n">tables</span><span class="o">=</span><span class="n">currencies</span><span class="w"> </span><span class="n">licenses</span><span class="w"> </span><span class="n">subscriptions</span><span class="w"> </span><span class="n">transactions</span>
<span class="o">::</span><span class="w"> </span><span class="n">Вариант</span><span class="w"> </span><span class="mi">2</span><span class="o">:</span><span class="w"> </span><span class="n">Чтение</span><span class="w"> </span><span class="n">таблиц</span><span class="w"> </span><span class="n">из</span><span class="w"> </span><span class="n">файла</span>
<span class="o">::</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="o">/</span><span class="n">p</span><span class="w"> </span><span class="n">tables</span><span class="o">=&lt;</span><span class="n">tables</span><span class="p">.</span><span class="n">txt</span>

<span class="o">::</span><span class="w"> </span><span class="n">Создание</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="n">dump</span><span class="w"> </span><span class="n">для</span><span class="w"> </span><span class="n">указанных</span><span class="w"> </span><span class="n">таблиц</span>
<span class="p">(</span><span class="k">for</span><span class="w"> </span><span class="o">%</span><span class="nf">%t</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="p">(</span><span class="nf">%tables</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">echo</span><span class="w"> </span><span class="n">DROP</span><span class="w"> </span><span class="n">TABLE</span><span class="w"> </span><span class="n">IF</span><span class="w"> </span><span class="n">EXISTS</span><span class="w"> </span><span class="k">public</span><span class="p">.</span><span class="o">%</span><span class="nf">%t</span><span class="p">;</span>
<span class="w">    </span><span class="nf">%psql_path</span><span class="o">%</span><span class="err">\</span><span class="n">bin</span><span class="err">\</span><span class="n">pg_dump</span><span class="w"> </span><span class="o">-</span><span class="n">U</span><span class="w"> </span><span class="n">postgres</span><span class="w"> </span><span class="o">-</span><span class="n">t</span><span class="w"> </span><span class="o">%</span><span class="nf">%t</span><span class="w"> </span><span class="n">d00m4ace</span>
<span class="w">    </span><span class="n">echo</span><span class="p">.</span>
<span class="p">))</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nf">%target</span><span class="o">%</span>

<span class="n">echo</span><span class="w"> </span><span class="n">Backup</span><span class="w"> </span><span class="n">completed</span><span class="o">:</span><span class="w"> </span><span class="nf">%target</span><span class="o">%</span>
</code></pre></div></div>
<p>Скрипт <code>dump.bat</code> выполняет следующие действия:</p>
<ol>
<li>Устанавливает путь к PostgreSQL и пароль.</li>
<li>Получает текущую дату и время.</li>
<li>Формирует имя файла для резервной копии с текущей датой и временем.</li>
<li>Определяет список таблиц для резервного копирования (либо напрямую в скрипте, либо из файла).</li>
<li>Создает SQL дамп для каждой указанной таблицы, включая команду DROP TABLE и данные таблицы.</li>
<li>Сохраняет все дампы в один файл с именем, содержащим текущую дату и время.</li>
<li>Выводит сообщение о завершении резервного копирования.</li>
</ol>
<p>Скрипт <code>run_dump.bat</code> периодически запускает <code>dump.bat</code> с заданным интервалом времени, пока его не остановят вручную.</p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code><span class="nv">@echo</span><span class="w"> </span><span class="k">off</span>
<span class="n">setlocal</span><span class="w"> </span><span class="n">enabledelayedexpansion</span>

<span class="o">::</span><span class="w"> </span><span class="n">Задайте</span><span class="w"> </span><span class="n">интервал</span><span class="w"> </span><span class="n">в</span><span class="w"> </span><span class="n">часах</span>
<span class="k">set</span><span class="w"> </span><span class="ss">"interval_hours=1"</span>
<span class="o">::</span><span class="w"> </span><span class="n">Преобразование</span><span class="w"> </span><span class="n">часов</span><span class="w"> </span><span class="n">в</span><span class="w"> </span><span class="n">секунды</span>
<span class="k">set</span><span class="w"> </span><span class="o">/</span><span class="n">a</span><span class="w"> </span><span class="ss">"delay_seconds=%interval_hours% * 3600"</span>

<span class="err">:</span><span class="n">loop</span>
<span class="n">echo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="k">dump</span><span class="p">.</span><span class="n">bat</span><span class="p">...</span>
<span class="k">call</span><span class="w"> </span><span class="k">dump</span><span class="p">.</span><span class="n">bat</span>

<span class="n">echo</span><span class="w"> </span><span class="n">Waiting</span><span class="w"> </span><span class="o">%</span><span class="n">interval_hours</span><span class="o">%</span><span class="w"> </span><span class="n">hours</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="n">startup</span><span class="p">...</span>
<span class="n">timeout</span><span class="w"> </span><span class="o">/</span><span class="n">t</span><span class="w"> </span><span class="o">%</span><span class="n">delay_seconds</span><span class="o">%</span><span class="w"> </span><span class="o">/</span><span class="n">nobreak</span>

<span class="k">goto</span><span class="w"> </span><span class="nl">loop</span>
</code></pre></div></div>
<p>Скрипт <code>run_dump.bat</code> выполняет следующие действия:</p>
<ol>
<li>Отключает вывод команд на экран (@echo off).</li>
<li>Устанавливает интервал в 1 час (можно изменить).</li>
<li>Преобразует интервал из часов в секунды.</li>
<li>Запускает бесконечный цикл, в котором:</li>
<li>Выполняет другой файл dump.bat</li>
<li>Ждет заданный интервал (по умолчанию 1 час)</li>
<li>Повторяет процесс</li>
</ol>
<p>Команды для восстановления базы данных PostgreSQL из полученных выше файлов:   </p>
<div class="codehilite"><div class="code-block"><button class="copy-code-button">Copy Code</button><pre><span></span><code>C:\PostgreSQL\16\pg_env.bat
C:\PostgreSQL\16\bin\pg_restore -U postgres -W -d d00m4ace -1 22.10.2024-12.08.49-dbbackup.tar 
C:\PostgreSQL\16\bin\psql -U postgres -W -d d00m4ace -1 -f 22.10.2024-11.44.23-dbbackup.sql
</code></pre></div></div>
<ol>
<li>
<p><code>C:\PostgreSQL\16\pg_env.bat</code>:
   Это файл пакетного сценария, который обычно устанавливает переменные среды для PostgreSQL. Он настраивает пути и другие параметры, необходимые для работы с PostgreSQL.</p>
</li>
<li>
<p><code>C:\PostgreSQL\16\bin\pg_restore -U postgres -W -d d00m4ace -1 22.10.2024-12.08.49-dbbackup.tar</code>:
   Эта команда восстанавливает базу данных из файла резервной копии '22.10.2024-12.08.49-dbbackup.tar':</p>
<ul>
<li><code>-U postgres</code>: использует пользователя 'postgres'</li>
<li><code>-W</code>: запрашивает пароль</li>
<li><code>-d d00m4ace</code>: восстанавливает в базу данных 'd00m4ace'</li>
<li><code>-1</code>: выполняет восстановление в одной транзакции   </li>
</ul>
</li>
<li>
<p><code>C:\PostgreSQL\16\bin\psql -U postgres -W -d d00m4ace -1 -f 22.10.2024-11.44.23-dbbackup.sql</code>:
   Эта команда выполняет SQL-скрипт для восстановления базы данных из файла резервной копии '22.10.2024-11.44.23-dbbackup.sql':</p>
<ul>
<li><code>-U postgres</code>: использует пользователя 'postgres'</li>
<li><code>-W</code>: запрашивает пароль</li>
<li><code>-d d00m4ace</code>: подключается к базе данных 'd00m4ace'</li>
<li><code>-1</code>: выполняет скрипт в одной транзакции</li>
<li><code>-f</code>: указывает на использование файла</li>
</ul>
</li>
</ol>
<h2>Мои домены</h2>
<h3>d00m4ace.com</h3>
<p><strong>d00m4ace.com</strong> - <a href="https://d00m4ace.com">https://d00m4ace.com</a></p>
<p>Редиректы 301 на d00m4ace.com:</p>
<ul>
<li><strong>doom4ace.com</strong> - <a href="https://doom4ace.com">https://doom4ace.com</a></li>
<li><strong>d00m4ace.ru</strong> - <a href="https://d00m4ace.ru">https://d00m4ace.ru</a></li>
<li><strong>doom4ace.ru</strong> - <a href="https://doom4ace.ru">https://doom4ace.ru</a></li>
<li>
<p><strong>doomface.ru</strong> - <a href="https://doomface.ru">https://doomface.ru</a></p>
</li>
<li>
<p><strong>doom39.ru</strong> - <a href="https://doom39.ru">https://doom39.ru</a></p>
</li>
<li><strong>d00m39.ru</strong> - <a href="https://d00m39.ru">https://d00m39.ru</a></li>
</ul>
<h3>hexplay.com</h3>
<p><strong>hexplay.com</strong> - <a href="https://hexplay.com">https://hexplay.com</a></p>
<h3>ООО "Локальные Интеллектуальные Системы"</h3>
<p><a href="https://ЛОКАЛЬНЫЕ-ИНТЕЛЛЕКТУАЛЬНЫЕ-СИСТЕМЫ.РФ">https://ЛОКАЛЬНЫЕ-ИНТЕЛЛЕКТУАЛЬНЫЕ-СИСТЕМЫ.РФ</a></p>
<hr/>
</article>

</main>
</section>

<footer class="footer has-text-centered" id="footer" style="padding-top: 10px; padding-bottom: 10px;">

    <p>
      <a href="https://github.com/d00m4ace" target="_blank">
      <img src="/imgs/github-mark.png" alt="D00M4ACE GitHub">
      </a> &nbsp;
	  <a href="https://t.me/d00m4ace_blog" target="_blank">
      <img src="/imgs/telega-mark.png" alt="D00M4ACE Telegram">
      </a> &nbsp;
	  <a href="https://www.youtube.com/@d00m4ace" target="_blank">
      <img src="/imgs/youtube-mark.png" alt="D00M4ACE YouTube">
      </a>
    </p>

<p>Copyright <strong>d00m4ace</strong> © 2024</p>
</footer>
</body>
</html>